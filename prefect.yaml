name: daily-main-pipeline
prefect-version: ">=3.0.0"
pull:
  - prefect.deployments.steps.git_clone:
      repository: "https://github.com/allyz1/Datboard_prefect.git"
      branch: "main"
      credentials: "{{ prefect.blocks.github-credentials.mygithubcreds }}"
  - prefect.deployments.steps.pip_install_requirements:
      directory: "{{ checkout.directory }}"
      requirements_file: "requirements.txt"

deployments:
  - name: daily
    flow_name: daily-main-pipeline
    entrypoint: "flows/daily_main_flow.py:daily_main_pipeline"
    work_pool:
      name: "managed-pool"
      job_variables:
        env:
          SUPABASE_URL: "{{ prefect.blocks.secret.supabaseurl }}"
          SUPABASE_SERVICE_KEY: "{{ prefect.blocks.secret.supabaseanonkey }}"
    schedule:
      cron: "0 6 * * *"
      timezone: "America/Los_Angeles"
