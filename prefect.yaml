name: daily-main-pipeline
prefect-version: ">=3.0.0"
pull:
  - prefect.deployments.steps.git_clone:
      repository: "https://github.com/allyz1/Datboard_prefect.git"
      branch: "main"
      credentials: "{{ prefect.blocks.github-credentials.mygithubcreds }}"
  - prefect.deployments.steps.pip_install_requirements:
      directory: "{{ clone.directory }}"
      requirements_file: requirements.txt
      stream_output: true
  - prefect.deployments.steps.run_shell_command:
      command: "pwd && ls -la"
      directory: "{{ clone.directory }}"

deployments:
  - name: daily
    flow_name: daily-main-pipeline
    entrypoint: "flows/daily_main_flow.py:daily_main_pipeline"
    work_pool:
      name: "managed-pool"
      job_variables:
        env:
          SUPABASE_URL: "{{ prefect.blocks.secret.superbaseurl }}"
          SUPABASE_SERVICE_KEY: "{{ prefect.blocks.secret.superbaseanonkey }}"
    schedule:
      cron: "0 6 * * *"
      timezone: "America/Los_Angeles"
